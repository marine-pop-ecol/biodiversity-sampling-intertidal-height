---
title: "group-summary"
author: "Meredith Miller, Carter Burtlake, Naomi Lubkin, Declan Taylor"
date: "01/11/2021"
output: pdf_document
---

```{r, include=FALSE}
library(here)
library(popbio)
library(vegan)
library(labdsv)
library(tidyverse)
```

## Introduction

**Hypothesis**: Differences in shore elevation affect the total biodiversity present due to differences in emersion time and wave splash.

Data was collected from Scott's Bay on Tuesday, October 26, 2021 using horizontal transects at two sites.  In our analysis, we used tidal heights (cm) and the number of individuals of each species in each quadrat. In order to investigate our hypothesis, Shannon diversity (H) indices were calculated at each tidal height and an anova was done in order to determine if there was a significant mean difference between biodiversity and tidal heights. Biodiversity (H) was then plotted against tidal height, and a linear regression was done in order to visualize the relationship between the two. 

## Data Analysis

### Importing the data
```{r, include=FALSE}
biodiversity <- read_csv(here("./Data/biodiversity.csv"))

percent_cover <- read_csv(here("./Data/percent-cover.csv")) 

quadrat_data <- read_csv(here("./Data/quadrat-data.csv"))
```

### Modifying the data

Please note that tidal heights were calculated using the Canadian Hydrographic Service's 2021 Tide and Current Tables (Vol. 5)

```{r, echo = FALSE, message = FALSE, warning = FALSE}
# Create a data.frame with the tidal height values for each quadrant
tidal_height <- quadrat_data %>%
  group_by(vertical_transect, quadrat) %>%
  summarize("quadrat_height_cm" = quadrat_height)

# Biodiversity is calculated using the diversity() function from the vegan
# package. The `biodiversity` dataframe needs to be reformatted to wide data
# to allow the "vegan" package to work.

# Setting up the `biodiversity` data.frame to the "3-column" format required by
# the matrify() function from the "labdsv" package.
matrify_biodiv <- biodiversity %>%
  drop_na(n) %>%
  group_by(vertical_transect, quadrat) %>%
  
  # Generating a unique ID that contains both the `vertial_transect` and 
  # `quadrat` information to be read by the matrify() function, which requires 
  # site to be contained within 1 column.
  mutate(unique_ID = as.numeric(
                        paste0(vertical_transect, ".", quadrat))) %>%
  select(unique_ID, species, n)

# Dropping the group by columns with irrelevant information
matrify_biodiv <- data.frame(
  matrify_biodiv[,3:5])

# Running the matrify function to create a data.frame that can be read by the
# "vegan" diversity() function.
vegan_biodiv <- matrify(matrify_biodiv)

# Save the Shannon Index data as a data.frame
ShannonIndex <- data.frame(
  diversity(vegan_biodiv, index = "shannon"))

# Modifications to the Shannon Index data
ShannonIndex <- ShannonIndex %>%
  # Turning the row names back into a column
  cbind(UniqueID = rownames(ShannonIndex)) %>%
  # Separating UniqueID back into distinct transect and quadrat numbers.
  separate(UniqueID,
           c("vertical_transect", "quadrat")) %>%
  # Adding quadrant height and wave exposure to the dataframe
  cbind("quadrat_height_cm" = tidal_height$quadrat_height_cm) %>%
  cbind("exposure" = quadrat_data$side) %>%
  #Fixing the column names.
  rename("ShannonIndex" = diversity.vegan_biodiv..index....shannon..)
```

```{r fig.align = 'left', echo=FALSE}
 knitr::kable(ShannonIndex, 
              caption = "Shannon Index values by intertidal height and exposure.", 
              align = "l")
```

### Analyzing the data

```{r, include=FALSE}
biodiv_lm <- lm(ShannonIndex ~ quadrat_height_cm, data = ShannonIndex)
summary(biodiv_lm)
```
p=0.7145, R-squared = -0.04752

```{r, include=FALSE}
# ANOVA
biodiv_aov <- aov(ShannonIndex ~ quadrat_height_cm, data = ShannonIndex)
summary(biodiv_aov)
```
p = 0.714

## Visualising the data
Here is a plot to visualize Shannon Diversity against quadrat height.
```{r, echo = FALSE, messages = FALSE}
# Create a plot
DiversityHeight_Plot <- ggplot(data = ShannonIndex,
         aes(x = quadrat_height_cm,
             y = ShannonIndex)) +
  geom_point(aes(colour = exposure)) +
  geom_smooth(colour = "black",
              size = 0.7,
              method = lm, se = FALSE) +
  labs(x = "Quadrat Height (cm)",
       y = "Shannon Index",
       colour = "Site Exposure") +
  theme_classic()

DiversityHeight_Plot

ggsave("DiversityHeight_Plot.png", 
       plot = DiversityHeight_Plot,
       device = png,
       path = "./Images")
```

Here is a boxplot to visualize how diversity between exposed and not exposed sites:

```{r, echo = FALSE, message=FALSE, warning=FALSE}
Diversity_Boxplot <- ggplot(data = ShannonIndex,
         aes(x = exposure,
             y = ShannonIndex)) +
  geom_boxplot(aes(fill = exposure)) +
  labs(x = "Site Exposure",
       y = "Species Diversity",
       fill = "Site Exposure") +
  guides(fill = "none") +
  theme_classic()

Diversity_Boxplot

ggsave("Diversity_Boxplot.png", 
       plot = Diversity_Boxplot,
       device = png,
       path = "./Images")
```


Here is a plot to visualize how species richness (as opposed to $H'$) differs with quadrat richness.

```{r, echo = FALSE, message = FALSE, warning=FALSE}
quad_richness <- biodiversity %>%
  drop_na(n) %>%
  group_by(vertical_transect, quadrat) %>%
  summarize(n_spp = length(unique(species))) %>%
  # Match the quadrat to a tidalhight value
  cbind("quadrat_height_cm" = tidal_height$quadrat_height_cm) %>%
  cbind("exposure" = quadrat_data$side)

QuadRichness_Plot <- ggplot(data = quad_richness,
         aes(x = quadrat_height_cm,
             y = n_spp)) +
  geom_point(aes(colour = exposure)) +
  geom_smooth(colour = "black",
              size = 0.7,
              method = lm, se = FALSE) +
  labs(x = "Quadrat Height (cm)",
       y = "Species Richness (n)",
       colour = "Site Exposure") +
  theme_classic()

QuadRichness_Plot

ggsave("QuadRichness_Plot.png", 
       plot = QuadRichness_Plot,
       device = png,
       path = "./Images")
```

